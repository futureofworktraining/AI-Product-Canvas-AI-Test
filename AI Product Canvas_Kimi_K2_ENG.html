<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Product Canvas</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.0/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --bg-light: #f8fafc;
            --border-color: #e2e8f0;
        }
        
        body {
            background-color: var(--bg-light);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .card {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s ease;
        }
        
        .card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .nav-tabs .nav-link {
            color: #64748b;
            border: none;
            padding: 12px 24px;
            margin-right: 8px;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s ease;
        }
        
        .nav-tabs .nav-link.active {
            background-color: white;
            color: var(--primary-color);
            font-weight: 600;
            box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
        }
        
        .btn-ai {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }
        
        .btn-ai:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }
        
        .btn-ai:disabled {
            background-color: #cbd5e1;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .section-header {
            color: #1e293b;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .section-icon {
            color: var(--primary-color);
            font-size: 1.25rem;
        }
        
        .form-label {
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }
        
        .form-control, .form-select {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .toast-container {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1055;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .action-buttons {
            position: sticky;
            bottom: 0;
            background: white;
            padding: 20px;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-cpu-fill me-2"></i>AI Product Canvas
            </span>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <ul class="nav nav-tabs" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="solution-tab" data-bs-toggle="tab" data-bs-target="#solution" type="button" role="tab">
                    <i class="bi bi-lightning me-2"></i>Solution Definition
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="business-tab" data-bs-toggle="tab" data-bs-target="#business" type="button" role="tab">
                    <i class="bi bi-graph-up me-2"></i>Business and User Aspects
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tech-tab" data-bs-toggle="tab" data-bs-target="#tech" type="button" role="tab">
                    <i class="bi bi-gear me-2"></i>Technological Aspects
                </button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabContent">
            <div class="tab-pane fade show active" id="solution" role="tabpanel">
                <div class="card mt-3">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="solutionName" class="form-label">
                                    <i class="bi bi-tag-fill section-icon"></i>Solution Name
                                </label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="solutionName" placeholder="Enter solution name">
                                    <button class="btn btn-ai" type="button" onclick="getAISuggestion('solutionName', 'Solution Name')">
                                        <i class="bi bi-stars me-1"></i>AI Suggestion
                                    </button>
                                </div>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label for="owner" class="form-label">
                                    <i class="bi bi-person-fill section-icon"></i>Owner
                                </label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="owner" placeholder="Enter owner name">
                                    <button class="btn btn-ai" type="button" onclick="getAISuggestion('owner', 'Owner')">
                                        <i class="bi bi-stars me-1"></i>AI Suggestion
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="shortDescription" class="form-label">
                                <i class="bi bi-card-text section-icon"></i>Short Description of the Solution
                            </label>
                            <div class="input-group">
                                <textarea class="form-control" id="shortDescription" rows="3" placeholder="Briefly describe the solution"></textarea>
                                <button class="btn btn-ai" type="button" onclick="getAISuggestion('shortDescription', 'Short Description of the Solution')">
                                    <i class="bi bi-stars me-1"></i>AI Suggestion
                                </button>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-8">
                                <label for="apiKey" class="form-label">
                                    <i class="bi bi-key-fill section-icon"></i>OpenAI API Key
                                </label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="apiKey" placeholder="Enter your OpenAI API key">
                                    <button class="btn btn-outline-primary" type="button" onclick="testConnection()">
                                        <i class="bi bi-wifi me-1"></i>Test Connection
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="business" role="tabpanel">
                <div class="card mt-3">
                    <div class="card-body">
                        <div class="mb-4">
                            <div class="section-header">
                                <h4>
                                    <i class="bi bi-exclamation-triangle-fill section-icon"></i>
                                    Problem and Business Value
                                </h4>
                                <button class="btn btn-ai ms-auto" type="button" onclick="getAISuggestion('problemBusinessValue', 'Problem and Business Value')">
                                    <i class="bi bi-stars me-1"></i>AI Suggestion
                                </button>
                            </div>
                            <textarea class="form-control" id="problemBusinessValue" rows="4" placeholder="Describe the problem and business value"></textarea>
                        </div>

                        <div class="mb-4">
                            <div class="section-header">
                                <h4>
                                    <i class="bi bi-database-fill section-icon"></i>
                                    Data
                                </h4>
                                <button class="btn btn-ai ms-auto" type="button" onclick="getAISuggestion('data', 'Data')">
                                    <i class="bi bi-stars me-1"></i>AI Suggestion
                                </button>
                            </div>
                            <textarea class="form-control" id="data" rows="4" placeholder="Describe the data requirements and sources"></textarea>
                        </div>

                        <div class="mb-4">
                            <div class="section-header">
                                <h4>
                                    <i class="bi bi-people-fill section-icon"></i>
                                    Users
                                </h4>
                                <button class="btn btn-ai ms-auto" type="button" onclick="getAISuggestion('users', 'Users')">
                                    <i class="bi bi-stars me-1"></i>AI Suggestion
                                </button>
                            </div>
                            <textarea class="form-control" id="users" rows="4" placeholder="Describe the target users and their needs"></textarea>
                        </div>

                        <div class="mb-4">
                            <div class="section-header">
                                <h4>
                                    <i class="bi bi-trophy-fill section-icon"></i>
                                    Solution Operation and Success Metrics
                                </h4>
                                <button class="btn btn-ai ms-auto" type="button" onclick="getAISuggestion('solutionOperation', 'Solution Operation and Success Metrics')">
                                    <i class="bi bi-stars me-1"></i>AI Suggestion
                                </button>
                            </div>
                            <textarea class="form-control" id="solutionOperation" rows="4" placeholder="Describe how the solution operates and how success will be measured"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="tech" role="tabpanel">
                <div class="card mt-3">
                    <div class="card-body">
                        <div class="mb-4">
                            <div class="section-header">
                                <h4>
                                    <i class="bi bi-robot section-icon"></i>
                                    Data and Models
                                </h4>
                                <button class="btn btn-ai ms-auto" type="button" onclick="getAISuggestion('dataModels', 'Data and Models')">
                                    <i class="bi bi-stars me-1"></i>AI Suggestion
                                </button>
                            </div>
                            <textarea class="form-control" id="dataModels" rows="4" placeholder="Describe the AI/ML models and data processing"></textarea>
                        </div>

                        <div class="mb-4">
                            <div class="section-header">
                                <h4>
                                    <i class="bi bi-shield-lock-fill section-icon"></i>
                                    Infrastructure and Security
                                </h4>
                                <button class="btn btn-ai ms-auto" type="button" onclick="getAISuggestion('infrastructureSecurity', 'Infrastructure and Security')">
                                    <i class="bi bi-stars me-1"></i>AI Suggestion
                                </button>
                            </div>
                            <textarea class="form-control" id="infrastructureSecurity" rows="4" placeholder="Describe the infrastructure and security requirements"></textarea>
                        </div>

                        <div class="mb-4">
                            <div class="section-header">
                                <h4>
                                    <i class="bi bi-palette-fill section-icon"></i>
                                    User Interface (UX)
                                </h4>
                                <button class="btn btn-ai ms-auto" type="button" onclick="getAISuggestion('userInterface', 'User Interface (UX)')">
                                    <i class="bi bi-stars me-1"></i>AI Suggestion
                                </button>
                            </div>
                            <textarea class="form-control" id="userInterface" rows="4" placeholder="Describe the user interface and experience design"></textarea>
                        </div>

                        <div class="mb-4">
                            <div class="section-header">
                                <h4>
                                    <i class="bi bi-code-slash section-icon"></i>
                                    Application Development
                                </h4>
                                <button class="btn btn-ai ms-auto" type="button" onclick="getAISuggestion('appDevelopment', 'Application Development')">
                                    <i class="bi bi-stars me-1"></i>AI Suggestion
                                </button>
                            </div>
                            <textarea class="form-control" id="appDevelopment" rows="4" placeholder="Describe the application development approach and technologies"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <button class="btn btn-outline-primary" onclick="loadCanvas()">
                            <i class="bi bi-upload me-2"></i>Load Canvas
                        </button>
                        <button class="btn btn-primary" onclick="saveCanvas()">
                            <i class="bi bi-download me-2"></i>Save Canvas
                        </button>
                        <button class="btn btn-success" onclick="exportDOCX()">
                            <i class="bi bi-file-earmark-word me-2"></i>Save as DOCX
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container"></div>

    <input type="file" id="fileInput" accept=".json" style="display: none;" onchange="handleFileImport(event)">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>

    <script>
        const fields = [
            'solutionName', 'owner', 'shortDescription',
            'problemBusinessValue', 'data', 'users', 'solutionOperation',
            'dataModels', 'infrastructureSecurity', 'userInterface', 'appDevelopment'
        ];

        function showToast(message, type = 'info') {
            const toastContainer = document.querySelector('.toast-container');
            const toastId = 'toast-' + Date.now();
            
            const toastHTML = `
                <div class="toast align-items-center text-white bg-${type === 'error' ? 'danger' : 'success'}" id="${toastId}" role="alert">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            const toast = new bootstrap.Toast(document.getElementById(toastId));
            toast.show();
            
            setTimeout(() => {
                document.getElementById(toastId).remove();
            }, 5000);
        }

        async function testConnection() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                showToast('Please enter your OpenAI API key', 'error');
                return;
            }

            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });

                if (response.ok) {
                    showToast('Connection successful!', 'success');
                } else {
                    throw new Error('Invalid API key');
                }
            } catch (error) {
                showToast('Connection failed: ' + error.message, 'error');
            }
        }

        async function getAISuggestion(fieldId, category) {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                showToast('Please enter your OpenAI API key', 'error');
                return;
            }

            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<span class="loading-spinner"></span> Generating...';
            button.disabled = true;

            try {
                const context = buildContext();
                const prompt = `The category for which an AI suggestion should be created is: ${category}\n\nContext:\n${context}`;

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a business analyst creating a solution specification. The user will provide the name of the category/area for which you will fill in based on other provided information. Match the suggestion to that category according to the attached context. Return only and exclusively the suggestion, without additional comments, examples, or context. It should be concise.'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                const suggestion = data.choices[0].message.content;
                
                document.getElementById(fieldId).value = suggestion;
                showToast('AI suggestion generated successfully!', 'success');
            } catch (error) {
                showToast('Failed to generate suggestion: ' + error.message, 'error');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        function buildContext() {
            let context = '';
            fields.forEach(field => {
                const value = document.getElementById(field)?.value || '';
                if (value) {
                    const label = field.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                    context += `${label}: ${value}\n`;
                }
            });
            return context;
        }

        function validateRequiredFields() {
            const requiredFields = ['solutionName', 'owner', 'shortDescription'];
            for (const field of requiredFields) {
                if (!document.getElementById(field).value.trim()) {
                    return false;
                }
            }
            return true;
        }

        function saveCanvas() {
            if (!validateRequiredFields()) {
                showToast('Please fill in Solution Name, Owner, and Short Description', 'error');
                return;
            }

            const canvas = {};
            fields.forEach(field => {
                canvas[field] = document.getElementById(field).value;
            });
            canvas.apiKey = document.getElementById('apiKey').value;

            const blob = new Blob([JSON.stringify(canvas, null, 2)], { type: 'application/json' });
            saveAs(blob, 'canvas.data.json');
            showToast('Canvas saved successfully!', 'success');
        }

        function loadCanvas() {
            document.getElementById('fileInput').click();
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const canvas = JSON.parse(e.target.result);
                    fields.forEach(field => {
                        if (canvas[field] !== undefined) {
                            document.getElementById(field).value = canvas[field];
                        }
                    });
                    if (canvas.apiKey) {
                        document.getElementById('apiKey').value = canvas.apiKey;
                    }
                    showToast('Canvas loaded successfully!', 'success');
                } catch (error) {
                    showToast('Failed to load canvas: Invalid file format', 'error');
                }
            };
            reader.readAsText(file);
        }

        function exportDOCX() {
            if (!validateRequiredFields()) {
                showToast('Please fill in Solution Name, Owner, and Short Description', 'error');
                return;
            }

            const doc = new docx.Document({
                sections: [{
                    properties: {},
                    children: [
                        new docx.Paragraph({
                            text: "AI Product Canvas",
                            heading: docx.HeadingLevel.TITLE,
                            alignment: docx.AlignmentType.CENTER,
                        }),
                        new docx.Paragraph({
                            text: "",
                            spacing: { after: 400 },
                        }),
                        new docx.Paragraph({
                            text: "Solution Definition",
                            heading: docx.HeadingLevel.HEADING_1,
                        }),
                        new docx.Paragraph({
                            text: "Solution Name: " + document.getElementById('solutionName').value,
                            spacing: { after: 200 },
                        }),
                        new docx.Paragraph({
                            text: "Owner: " + document.getElementById('owner').value,
                            spacing: { after: 200 },
                        }),
                        new docx.Paragraph({
                            text: "Short Description: " + document.getElementById('shortDescription').value,
                            spacing: { after: 400 },
                        }),
                        new docx.Paragraph({
                            text: "Business and User Aspects",
                            heading: docx.HeadingLevel.HEADING_1,
                        }),
                        new docx.Paragraph({
                            text: "Problem and Business Value: " + document.getElementById('problemBusinessValue').value,
                            spacing: { after: 200 },
                        }),
                        new docx.Paragraph({
                            text: "Data: " + document.getElementById('data').value,
                            spacing: { after: 200 },
                        }),
                        new docx.Paragraph({
                            text: "Users: " + document.getElementById('users').value,
                            spacing: { after: 200 },
                        }),
                        new docx.Paragraph({
                            text: "Solution Operation and Success Metrics: " + document.getElementById('solutionOperation').value,
                            spacing: { after: 400 },
                        }),
                        new docx.Paragraph({
                            text: "Technological Aspects",
                            heading: docx.HeadingLevel.HEADING_1,
                        }),
                        new docx.Paragraph({
                            text: "Data and Models: " + document.getElementById('dataModels').value,
                            spacing: { after: 200 },
                        }),
                        new docx.Paragraph({
                            text: "Infrastructure and Security: " + document.getElementById('infrastructureSecurity').value,
                            spacing: { after: 200 },
                        }),
                        new docx.Paragraph({
                            text: "User Interface (UX): " + document.getElementById('userInterface').value,
                            spacing: { after: 200 },
                        }),
                        new docx.Paragraph({
                            text: "Application Development: " + document.getElementById('appDevelopment').value,
                        }),
                    ],
                }]
            });

            docx.Packer.toBlob(doc).then(blob => {
                saveAs(blob, "AI Product Canvas.docx");
                showToast('DOCX exported successfully!', 'success');
            });
        }
    </script>
</body>
</html>
