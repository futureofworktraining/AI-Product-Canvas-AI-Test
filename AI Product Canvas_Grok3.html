<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Product Canvas</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome dla ikonek -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Style niestandardowe -->
    <style>
        body {
            background-color: #f8f9fa;
            font-family: Arial, sans-serif;
        }
        .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: white;
        }
        .tab-content {
            background-color: white;
            padding: 20px;
            border-radius: 0 0 5px 5px;
            border: 1px solid #dee2e6;
            border-top: none;
        }
        .form-section {
            margin-bottom: 20px;
        }
        .suggest-btn {
            margin-left: 10px;
        }
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">AI Product Canvas</h1>
        <ul class="nav nav-tabs" id="canvasTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="definition-tab" data-bs-toggle="tab" data-bs-target="#definition" type="button" role="tab">Definicja Rozwiązania</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="business-tab" data-bs-toggle="tab" data-bs-target="#business" type="button" role="tab">Aspekty Biznesowe i Użytkownik</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="tech-tab" data-bs-toggle="tab" data-bs-target="#tech" type="button" role="tab">Aspekty Technologiczne</button>
            </li>
        </ul>
        <div class="tab-content" id="canvasTabContent">
            <!-- Definicja Rozwiązania -->
            <div class="tab-pane fade show active" id="definition" role="tabpanel">
                <div class="form-section">
                    <label for="solutionName"><i class="fas fa-lightbulb me-2"></i>Nazwa rozwiązania</label>
                    <button class="btn btn-outline-primary btn-sm suggest-btn" onclick="suggestAI('Nazwa rozwiązania')">Sugestia AI</button>
                    <input type="text" class="form-control" id="solutionName">
                </div>
                <div class="form-section">
                    <label for="owner"><i class="fas fa-user me-2"></i>Właściciel</label>
                    <button class="btn btn-outline-primary btn-sm suggest-btn" onclick="suggestAI('Właściciel')">Sugestia AI</button>
                    <input type="text" class="form-control" id="owner">
                </div>
                <div class="form-section">
                    <label for="description"><i class="fas fa-file-alt me-2"></i>Krótki opis rozwiązania</label>
                    <button class="btn btn-outline-primary btn-sm suggest-btn" onclick="suggestAI('Krótki opis rozwiązania')">Sugestia AI</button>
                    <textarea class="form-control" id="description" rows="3"></textarea>
                </div>
                <div class="form-section">
                    <label for="apiKey"><i class="fas fa-key me-2"></i>Klucz API OpenAI</label>
                    <input type="password" class="form-control" id="apiKey">
                    <button class="btn btn-secondary mt-2" onclick="testConnection()">Test połączenia</button>
                </div>
            </div>
            <!-- Aspekty Biznesowe i Użytkownik -->
            <div class="tab-pane fade" id="business" role="tabpanel">
                <div class="form-section">
                    <label for="problem"><i class="fas fa-exclamation-circle me-2"></i>Problem i wartość biznesowa</label>
                    <button class="btn btn-outline-primary btn-sm suggest-btn" onclick="suggestAI('Problem i wartość biznesowa')">Sugestia AI</button>
                    <textarea class="form-control" id="problem" rows="3"></textarea>
                </div>
                <div class="form-section">
                    <label for="data"><i class="fas fa-database me-2"></i>Dane</label>
                    <button class="btn btn-outline-primary btn-sm suggest-btn" onclick="suggestAI('Dane')">Sugestia AI</button>
                    <textarea class="form-control" id="data" rows="3"></textarea>
                </div>
                <div class="form-section">
                    <label for="users"><i class="fas fa-users me-2"></i>Użytkownicy</label>
                    <button class="btn btn-outline-primary btn-sm suggest-btn" onclick="suggestAI('Użytkownicy')">Sugestia AI</button>
                    <textarea class="form-control" id="users" rows="3"></textarea>
                </div>
                <div class="form-section">
                    <label for="metrics"><i class="fas fa-chart-line me-2"></i>Działanie rozwiązania i mierniki sukcesu</label>
                    <button class="btn btn-outline-primary btn-sm suggest-btn" onclick="suggestAI('Działanie rozwiązania i mierniki sukcesu')">Sugestia AI</button>
                    <textarea class="form-control" id="metrics" rows="3"></textarea>
                </div>
            </div>
            <!-- Aspekty Technologiczne -->
            <div class="tab-pane fade" id="tech" role="tabpanel">
                <div class="form-section">
                    <label for="techData"><i class="fas fa-cogs me-2"></i>Dane i modele</label>
                    <button class="btn btn-outline-primary btn-sm suggest-btn" onclick="suggestAI('Dane i modele')">Sugestia AI</button>
                    <textarea class="form-control" id="techData" rows="3"></textarea>
                </div>
                <div class="form-section">
                    <label for="infra"><i class="fas fa-server me-2"></i>Infrastruktura i bezpieczeństwo</label>
                    <button class="btn btn-outline-primary btn-sm suggest-btn" onclick="suggestAI('Infrastruktura i bezpieczeństwo')">Sugestia AI</button>
                    <textarea class="form-control" id="infra" rows="3"></textarea>
                </div>
                <div class="form-section">
                    <label for="ux"><i class="fas fa-desktop me-2"></i>Interfejs użytkownika (UX)</label>
                    <button class="btn btn-outline-primary btn-sm suggest-btn" onclick="suggestAI('Interfejs użytkownika (UX)')">Sugestia AI</button>
                    <textarea class="form-control" id="ux" rows="3"></textarea>
                </div>
                <div class="form-section">
                    <label for="dev"><i class="fas fa-code me-2"></i>Rozwój aplikacji</label>
                    <button class="btn btn-outline-primary btn-sm suggest-btn" onclick="suggestAI('Rozwój aplikacji')">Sugestia AI</button>
                    <textarea class="form-control" id="dev" rows="3"></textarea>
                </div>
            </div>
        </div>
        <div class="mt-3 text-end">
            <input type="file" id="importFile" style="display:none" accept=".json" onchange="importCanvas()">
            <button class="btn btn-primary me-2" onclick="document.getElementById('importFile').click()">Wczytaj Kanwę</button>
            <button class="btn btn-primary me-2" onclick="saveCanvas()">Zapisz Kanwę</button>
            <button class="btn btn-primary" onclick="saveAsDocx()">Zapisz jako DOCX</button>
        </div>
    </div>
    <div class="toast-container"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>
    <!-- docx.js -->
    <script src="https://unpkg.com/docx@7.1.0/build/index.js"></script>
    <!-- FileSaver.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.js"></script>
    <!-- JavaScript aplikacji -->
    <script>
        async function suggestAI(category) {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                showToast('Proszę wprowadzić klucz API OpenAI.', 'error');
                return;
            }

            const context = gatherContext();
            const userPrompt = `Kategoria dla której powinien utworzyć sugestie to: ${category}\nKontekst: ${context}`;
            const systemPrompt = "Jesteś business analitykiem tworzącym specyfikację rozwiązania. Użytkownik poda Ci nazwę kategorii/obszar krzy ty uzupełnisz na podstawie dostarczonych Ci innych informacji. kategorię. Dobierz sugestię do tej kategorii zgodnie z załączonym kontekstem. Zwróć tylko i wyłącznie sugestię, bez dodatkowych komentarzy, przykładów lub kontekstu. Powinno być węźle.";

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            { role: 'user', content: userPrompt }
                        ]
                    })
                });

                if (!response.ok) throw new Error('Błąd połączenia z API');
                const data = await response.json();
                const suggestion = data.choices[0].message.content;
                document.getElementById(getFieldId(category)).value = suggestion;
                showToast('Sugestia AI została wygenerowana.', 'info');
            } catch (error) {
                showToast('Błąd podczas generowania sugestii AI: ' + error.message, 'error');
            }
        }

        function gatherContext() {
            const fields = ['solutionName', 'owner', 'description', 'problem', 'data', 'users', 'metrics', 'techData', 'infra', 'ux', 'dev'];
            return fields.map(id => `${idToLabel(id)}: ${document.getElementById(id)?.value || ''}`).join(' ');
        }

        function idToLabel(id) {
            const labels = {
                solutionName: 'Nazwa rozwiązania',
                owner: 'Właściciel',
                description: 'Krótki opis rozwiązania',
                problem: 'Problem i wartość biznesowa',
                data: 'Dane',
                users: 'Użytkownicy',
                metrics: 'Działanie rozwiązania i mierniki sukcesu',
                techData: 'Dane i modele',
                infra: 'Infrastruktura i bezpieczeństwo',
                ux: 'Interfejs użytkownika (UX)',
                dev: 'Rozwój aplikacji'
            };
            return labels[id] || id;
        }

        function getFieldId(category) {
            const mapping = {
                'Nazwa rozwiązania': 'solutionName',
                'Właściciel': 'owner',
                'Krótki opis rozwiązania': 'description',
                'Problem i wartość biznesowa': 'problem',
                'Dane': 'data',
                'Użytkownicy': 'users',
                'Działanie rozwiązania i mierniki sukcesu': 'metrics',
                'Dane i modele': 'techData',
                'Infrastruktura i bezpieczeństwo': 'infra',
                'Interfejs użytkownika (UX)': 'ux',
                'Rozwój aplikacji': 'dev'
            };
            return mapping[category];
        }

        async function testConnection() {
            const apiKey = document.getElementById('apiKey').value;
            if (!apiKey) {
                showToast('Proszę wprowadzić klucz API OpenAI.', 'error');
                return;
            }

            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    headers: { 'Authorization': `Bearer ${apiKey}` }
                });
                if (response.ok) {
                    showToast('Połączenie z API OpenAI powiodło się.', 'info');
                } else {
                    showToast('Błąd połączenia z API OpenAI.', 'error');
                }
            } catch (error) {
                showToast('Błąd połączenia: ' + error.message, 'error');
            }
        }

        function saveCanvas() {
            const requiredFields = ['solutionName', 'owner', 'description'];
            for (let field of requiredFields) {
                if (!document.getElementById(field).value) {
                    showToast('Proszę wypełnić wszystkie wymagane pola.', 'error');
                    return;
                }
            }

            const data = gatherContext();
            const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
            saveAs(blob, 'canvas.data.json');
            showToast('Kanwa została zapisana.', 'info');
        }

        function importCanvas() {
            const file = document.getElementById('importFile').files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = JSON.parse(e.target.result);
                const pairs = data.split(' ').reduce((acc, pair) => {
                    const [key, value] = pair.split(':');
                    acc[key] = value;
                    return acc;
                }, {});
                Object.keys(pairs).forEach(key => {
                    const fieldId = getFieldId(idToLabel(key));
                    if (fieldId && document.getElementById(fieldId)) {
                        document.getElementById(fieldId).value = pairs[key];
                    }
                });
                showToast('Kanwa została wczytana.', 'info');
            };
            reader.readAsText(file);
        }

        function saveAsDocx() {
            const requiredFields = ['solutionName', 'owner', 'description'];
            for (let field of requiredFields) {
                if (!document.getElementById(field).value) {
                    showToast('Proszę wypełnić wszystkie wymagane pola.', 'error');
                    return;
                }
            }

            const doc = new docx.Document({
                sections: [{
                    children: [
                        new docx.Paragraph({
                            text: "AI Product Canvas",
                            heading: docx.HeadingLevel.HEADING_1
                        }),
                        new docx.Paragraph({ text: "Definicja Rozwiązania", heading: docx.HeadingLevel.HEADING_2 }),
                        new docx.Paragraph({ text: `Nazwa rozwiązania: ${document.getElementById('solutionName').value}` }),
                        new docx.Paragraph({ text: `Właściciel: ${document.getElementById('owner').value}` }),
                        new docx.Paragraph({ text: `Krótki opis rozwiązania: ${document.getElementById('description').value}` }),
                        new docx.Paragraph({ text: "Aspekty Biznesowe i Użytkownik", heading: docx.HeadingLevel.HEADING_2 }),
                        new docx.Paragraph({ text: `Problem i wartość biznesowa: ${document.getElementById('problem').value}` }),
                        new docx.Paragraph({ text: `Dane: ${document.getElementById('data').value}` }),
                        new docx.Paragraph({ text: `Użytkownicy: ${document.getElementById('users').value}` }),
                        new docx.Paragraph({ text: `Działanie rozwiązania i mierniki sukcesu: ${document.getElementById('metrics').value}` }),
                        new docx.Paragraph({ text: "Aspekty Technologiczne", heading: docx.HeadingLevel.HEADING_2 }),
                        new docx.Paragraph({ text: `Dane i modele: ${document.getElementById('techData').value}` }),
                        new docx.Paragraph({ text: `Infrastruktura i bezpieczeństwo: ${document.getElementById('infra').value}` }),
                        new docx.Paragraph({ text: `Interfejs użytkownika (UX): ${document.getElementById('ux').value}` }),
                        new docx.Paragraph({ text: `Rozwój aplikacji: ${document.getElementById('dev').value}` })
                    ]
                }]
            });

            docx.Packer.toBlob(doc).then(blob => {
                saveAs(blob, "AI_Product_Canvas.docx");
                showToast('Dokument DOCX został wygenerowany.', 'info');
            });
        }

        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white ${type === 'error' ? 'bg-danger' : 'bg-info'} border-0`;
            toast.role = 'alert';
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>`;
            document.querySelector('.toast-container').appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            setTimeout(() => toast.remove(), 5000);
        }
    </script>
</body>
</html>